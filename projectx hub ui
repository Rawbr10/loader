local Library = {}
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Silkscreen = Enum.Font.SourceSans
local GothamBold = Enum.Font.GothamBold
local Gotham = Enum.Font.Gotham

function Library:Window(options)
    local Window = {}
    local states = {} 
    local currentTab = nil
    local tabButtons = {}
    local tabContents = {}

local HttpService = game:GetService("HttpService")
local configName = options.Config.FileName or "AzcHub_Config.json"

function Window:SaveConfig()
    local data = {}
    for key, value in pairs(states) do
        data[key] = value
    end
    writefile(configName, HttpService:JSONEncode(data))
end

function Window:LoadConfig()
    if not isfile(configName) then return end
    local saved = HttpService:JSONDecode(readfile(configName))
    for key, value in pairs(saved) do
        states[key] = value
    end
end

task.defer(function()
    Window:LoadConfig()
end)

local oldToggle = Window.Toggle
function Window:Toggle(tglOptions)
    local TabToggle = oldToggle(self, tglOptions)
    local originalCallback = tglOptions.Callback
    tglOptions.Callback = function(val)
        if originalCallback then originalCallback(val) end
        Window:SaveConfig()
    end
    return TabToggle
end

local oldSlider = Window.Slider
function Window:Slider(sldOptions)
    local TabSlider = oldSlider(self, sldOptions)
    local originalCallback = sldOptions.Callback
    sldOptions.Callback = function(val)
        if originalCallback then originalCallback(val) end
        Window:SaveConfig()
    end
    return TabSlider
end

local oldTextbox = Window.Textbox
function Window:Textbox(txtOptions)
    local TabTextbox = oldTextbox(self, txtOptions)
    local originalCallback = txtOptions.Callback
    txtOptions.Callback = function(val)
        if originalCallback then originalCallback(val) end
        Window:SaveConfig()
    end
    return TabTextbox
end

local oldDropdown = Window.Dropdown
function Window:Dropdown(ddOptions)
    local TabDropdown = oldDropdown(self, ddOptions)
    local originalCallback = ddOptions.Callback
    ddOptions.Callback = function(val)
        if originalCallback then originalCallback(val) end
        Window:SaveConfig()
    end
    return TabDropdown
end

    options = options or {}
    options.Config = options.Config or {}

    local Player = game.Players.LocalPlayer
    local PlayerGui = Player:WaitForChild("PlayerGui")

    if PlayerGui:FindFirstChild("AzcHub_Window") then
        PlayerGui.AzcHub_Window:Destroy()
    end

    local ScreenGui = Instance.new("ScreenGui", PlayerGui)
    ScreenGui.Name = "AzcHub_Window"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    local Main = Instance.new("Frame", ScreenGui)
    Main.Size = options.Config.Size or UDim2.new(0, 500, 0, 400)
    Main.Position = UDim2.new(0.5, -Main.Size.X.Offset / 2, 0.5, -Main.Size.Y.Offset / 2)
    Main.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
    Main.BackgroundTransparency = 0.1
    Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 10)
    Instance.new("UIStroke", Main).Color = Color3.fromRGB(255, 255, 255)

    local dragging = false
    local dragStart, startPos
    Main.InputBegan:Connect(function(input)
        if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) and input.Position.Y < Main.AbsolutePosition.Y + 40 then
            dragging, dragStart, startPos = true, input.Position, Main.Position
        end
    end)
    Main.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)

    local Header = Instance.new("Frame", Main)
    Header.Size, Header.BackgroundColor3, Header.BackgroundTransparency = UDim2.new(1, 0, 0, 40), Color3.fromRGB(25, 25, 25), 0.3
    Instance.new("UICorner", Header).CornerRadius = UDim.new(0, 10)

    local Title = Instance.new("TextLabel", Header)
    Title.Size, Title.Position, Title.Font, Title.TextSize, Title.BackgroundTransparency, Title.TextColor3, Title.TextXAlignment = UDim2.new(0.8, 0, 1, 0), UDim2.new(0, 15, 0, 0), Silkscreen, 22, 1, Color3.fromRGB(255, 255, 255), Enum.TextXAlignment.Left
    Title.Text = options.Title or "UI Library"

    local Tabs = Instance.new("Frame", Main)
    Tabs.Size, Tabs.Position, Tabs.BackgroundColor3 = UDim2.new(0, 120, 1, -45), UDim2.new(0, 0, 0, 45), Color3.fromRGB(20, 20, 20), 0
    Instance.new("UICorner", Tabs).CornerRadius = UDim.new(0, 10)
    local TabsListLayout = Instance.new("UIListLayout", Tabs)
    TabsListLayout.Padding, TabsListLayout.HorizontalAlignment = UDim.new(0, 5), Enum.HorizontalAlignment.Center

    local Content = Instance.new("Frame", Main)
    Content.Size, Content.Position, Content.BackgroundColor3 = UDim2.new(1, -140, 1, -45), UDim2.new(0, 130, 0, 45), Color3.fromRGB(10, 10, 10)
    Instance.new("UICorner", Content).CornerRadius = UDim.new(0, 10)

    local Scroll = Instance.new("ScrollingFrame", Content)
    Scroll.Size, Scroll.BackgroundTransparency, Scroll.ScrollBarThickness = UDim2.new(1, 0, 1, 0), 1, 6
    local UIList = Instance.new("UIListLayout", Scroll)
    UIList.Padding, UIList.HorizontalAlignment = UDim.new(0, 10), Enum.HorizontalAlignment.Center
    UIList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function() Scroll.CanvasSize = UDim2.new(0, 0, 0, UIList.AbsoluteContentSize.Y + 20) end)

    function Window:Notify(notifOptions)
        local notifFrame = Instance.new("Frame", ScreenGui)
        notifFrame.Size = UDim2.new(0, 250, 0, 60)
        notifFrame.Position = UDim2.new(1, -270, 1, 20)
        notifFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
        Instance.new("UICorner", notifFrame).CornerRadius = UDim.new(0, 8)
        Instance.new("UIStroke", notifFrame).Color = Color3.fromRGB(80, 120, 255)

        local notifTitle = Instance.new("TextLabel", notifFrame)
        notifTitle.Size, notifTitle.Position, notifTitle.Font, notifTitle.TextSize, notifTitle.TextColor3, notifTitle.BackgroundTransparency, notifTitle.TextXAlignment = UDim2.new(1, -15, 0, 25), UDim2.new(0, 10, 0, 0), GothamBold, 16, Color3.fromRGB(255, 255, 255), 1, Enum.TextXAlignment.Left
        notifTitle.Text = notifOptions.Title or "Notification"

        local notifDesc = Instance.new("TextLabel", notifFrame)
        notifDesc.Size, notifDesc.Position, notifDesc.Font, notifDesc.TextSize, notifDesc.TextColor3, notifDesc.BackgroundTransparency, notifDesc.TextXAlignment = UDim2.new(1, -15, 0, 25), UDim2.new(0, 10, 0, 25), Gotham, 14, Color3.fromRGB(200, 200, 200), 1, Enum.TextXAlignment.Left
        notifDesc.Text = notifOptions.Desc or "Something happened."

        local openTween = TweenService:Create(notifFrame, TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {Position = UDim2.new(1, -270, 1, -80)})
        local closeTween = TweenService:Create(notifFrame, TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.In), {Position = UDim2.new(1, -270, 1, 20)})
        
        openTween:Play()
        task.delay(notifOptions.Time or 3, function()
            closeTween:Play()
            closeTween.Completed:Wait()
            notifFrame:Destroy()
        end)
    end

    function Window:Tab(tabOptions)
        local Tab = {}
        local tabName = tabOptions.Title or "Tab"
        local tabContentContainer = Instance.new("Frame") -- Invisible container to hold tab elements
        
        local Btn = Instance.new("TextButton", Tabs)
        Btn.Size, Btn.BackgroundColor3, Btn.Font, Btn.TextSize, Btn.TextColor3, Btn.Text = UDim2.new(1, -20, 0, 35), Color3.fromRGB(40, 40, 40), Silkscreen, 18, Color3.fromRGB(255, 255, 255), tabName
        Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 8)
        tabButtons[tabName] = Btn
        tabContents[tabName] = tabContentContainer

        Btn.MouseButton1Click:Connect(function()
            if currentTab == tabName then return end
            currentTab = tabName
            for name, btn in pairs(tabButtons) do btn.BackgroundColor3 = (name == tabName) and Color3.fromRGB(80, 120, 255) or Color3.fromRGB(40, 40, 40) end
            for _, child in ipairs(Scroll:GetChildren()) do if not child:IsA("UIListLayout") then child:Destroy() end end
            for _, child in ipairs(tabContents[tabName]:GetChildren()) do child.Parent = Scroll end
        end)

        local function CreateElementFrame(size)
            local Frame = Instance.new("Frame", tabContentContainer)
            Frame.Size = size
            Frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 10)
            return Frame
        end

        function Tab:Section(secOptions)
            local Frame = Instance.new("Frame", tabContentContainer)
            Frame.Size = UDim2.new(1, -20, 0, 30)
            Frame.BackgroundTransparency = 1
            local Text = Instance.new("TextLabel", Frame)
            Text.Size, Text.BackgroundTransparency, Text.Font, Text.TextSize, Text.TextColor3, Text.TextXAlignment = UDim2.new(1, 0, 1, 0), 1, GothamBold, 16, Color3.fromRGB(200, 200, 200), Enum.TextXAlignment.Left
            Text.Text = secOptions.Title or "Section"
            local Line = Instance.new("Frame", Frame)
            Line.Size, Line.Position, Line.BackgroundColor3, Line.BorderSizePixel = UDim2.new(1, 0, 0, 1), UDim2.new(0, 0, 1, -5), Color3.fromRGB(55, 55, 55), 0
        end

        function Tab:Button(btnOptions)
            local Frame = CreateElementFrame(UDim2.new(1, -20, 0, 40))
            Frame.ClassName = "TextButton"
            local Title = Instance.new("TextLabel", Frame)
            Title.Size, Title.BackgroundTransparency, Title.Font, Title.TextSize, Title.TextColor3 = UDim2.new(1, 0, 1, 0), 1, Silkscreen, 18, Color3.fromRGB(255, 255, 255)
            Title.Text = btnOptions.Title or "Button"
            Frame.MouseButton1Click:Connect(btnOptions.Callback or function() end)
        end

        function Tab:Toggle(tglOptions)
            local Frame = CreateElementFrame(UDim2.new(1, -20, 0, 45))
            states[tglOptions.Title] = tglOptions.Value or false
            
            local Label = Instance.new("TextLabel", Frame)
            Label.Size, Label.Position, Label.BackgroundTransparency, Label.Font, Label.TextSize, Label.TextColor3, Label.TextXAlignment = UDim2.new(1, -70, 1, 0), UDim2.new(0, 10, 0, 0), 1, Silkscreen, 18, Color3.fromRGB(255, 255, 255), Enum.TextXAlignment.Left
            Label.Text = tglOptions.Title or "Toggle"

            local toggleButton = Instance.new("TextButton", Frame)
            toggleButton.Size, toggleButton.Position, toggleButton.Text = UDim2.new(0, 40, 0, 20), UDim2.new(1, -55, 0.5, -10), ""
            Instance.new("UICorner", toggleButton).CornerRadius = UDim.new(1, 0)
            local circle = Instance.new("Frame", toggleButton)
            circle.Size, circle.BorderSizePixel = UDim2.new(0, 18, 0, 18), 0
            Instance.new("UICorner", circle).CornerRadius = UDim.new(1, 0)

            local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quart)
            local function updateVisuals(toggled, instant)
                local pos, bgColor, circleColor = toggled and UDim2.new(1, -19, 0.5, -9) or UDim2.new(0, 1, 0.5, -9), toggled and Color3.fromRGB(0, 100, 0) or Color3.fromRGB(25, 25, 25), toggled and Color3.fromRGB(0, 170, 0) or Color3.fromRGB(80, 80, 80)
                if instant then circle.Position, toggleButton.BackgroundColor3, circle.BackgroundColor3 = pos, bgColor, circleColor
                else TweenService:Create(circle, tweenInfo, {Position = pos}):Play(); TweenService:Create(toggleButton, tweenInfo, {BackgroundColor3 = bgColor}):Play(); TweenService:Create(circle, tweenInfo, {BackgroundColor3 = circleColor}):Play() end
            end
            updateVisuals(states[tglOptions.Title], true)
            toggleButton.MouseButton1Click:Connect(function()
                states[tglOptions.Title] = not states[tglOptions.Title]
                updateVisuals(states[tglOptions.Title])
                if tglOptions.Callback then tglOptions.Callback(states[tglOptions.Title]) end
            end)
        end

        function Tab:Slider(sldOptions)
            local Frame = CreateElementFrame(UDim2.new(1, -20, 0, 60))
            Frame.BackgroundTransparency = 1
            states[sldOptions.Title] = sldOptions.Value or sldOptions.Min or 0

            local TitleLabel = Instance.new("TextLabel", Frame)
            TitleLabel.Size, TitleLabel.BackgroundTransparency, TitleLabel.Font, TitleLabel.TextSize, TitleLabel.TextColor3 = UDim2.new(1, 0, 0, 20), 1, Silkscreen, 16, Color3.fromRGB(255, 255, 255)
            
            local SliderBar = Instance.new("Frame", Frame)
            SliderBar.Position, SliderBar.Size, SliderBar.BackgroundColor3 = UDim2.new(0, 10, 0, 30), UDim2.new(1, -20, 0, 10), Color3.fromRGB(25, 25, 25)
            Instance.new("UICorner", SliderBar).CornerRadius = UDim.new(1, 0)
            local Fill = Instance.new("Frame", SliderBar)
            Fill.BackgroundColor3 = Color3.fromRGB(80, 120, 255); Instance.new("UICorner", Fill).CornerRadius = UDim.new(1, 0)

            local isDragging = false
            local function updateSlider(inputPos)
                local pos = math.clamp((inputPos.X - SliderBar.AbsolutePosition.X) / SliderBar.AbsoluteSize.X, 0, 1)
                local rawValue = (sldOptions.Min or 0) + ((sldOptions.Max or 100) - (sldOptions.Min or 0)) * pos
                local value = math.floor(rawValue / (10^-(sldOptions.Rounding or 0)) + 0.5) * (10^-(sldOptions.Rounding or 0))
                states[sldOptions.Title], Fill.Size, TitleLabel.Text = value, UDim2.new(pos, 0, 1, 0), sldOptions.Title .. ": " .. value
                if sldOptions.Callback then sldOptions.Callback(value) end
            end
            local initialPos = ((states[sldOptions.Title] - (sldOptions.Min or 0)) / ((sldOptions.Max or 100) - (sldOptions.Min or 0)))
            Fill.Size = UDim2.new(initialPos, 0, 1, 0)
            TitleLabel.Text = sldOptions.Title .. ": " .. states[sldOptions.Title]

            SliderBar.InputBegan:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then isDragging = true; updateSlider(input.Position) end end)
            SliderBar.InputEnded:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then isDragging = false end end)
            SliderBar.InputChanged:Connect(function(input) if isDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then updateSlider(input.Position) end end)
        end

        function Tab:Textbox(txtOptions)
            local Frame = CreateElementFrame(UDim2.new(1, -20, 0, 45))
            states[txtOptions.Title] = txtOptions.Value or ""
            
            local TextBox = Instance.new("TextBox", Frame)
            TextBox.Size, TextBox.BackgroundColor3, TextBox.Font, TextBox.TextSize, TextBox.TextColor3 = UDim2.new(1, 0, 1, 0), Color3.fromRGB(30, 30, 30), Gotham, 16, Color3.fromRGB(220, 220, 220)
            TextBox.PlaceholderText = txtOptions.Placeholder or "..."
            TextBox.Text = states[txtOptions.Title]
            TextBox.ClearTextOnFocus = txtOptions.ClearTextOnFocus or false
            Instance.new("UICorner", TextBox).CornerRadius = UDim.new(0, 8)
            Instance.new("UIPadding", TextBox).PaddingLeft = UDim.new(0, 10)

            TextBox:GetPropertyChangedSignal("Text"):Connect(function()
                states[txtOptions.Title] = TextBox.Text
                if txtOptions.Callback then txtOptions.Callback(TextBox.Text) end
            end)
        end

        function Tab:Dropdown(ddOptions)
            local Frame = Instance.new("Frame", tabContentContainer)
            Frame.Size, Frame.BackgroundTransparency, Frame.ZIndex = UDim2.new(1, -20, 0, 45), 1, 2
            states[ddOptions.Title] = ddOptions.Value or ddOptions.List[1]

            local TitleBtn = Instance.new("TextButton", Frame)
            TitleBtn.Size, TitleBtn.BackgroundColor3, TitleBtn.Font, TitleBtn.TextSize, TitleBtn.TextColor3, TitleBtn.TextXAlignment = UDim2.new(1, 0, 1, 0), Color3.fromRGB(30, 30, 30), GothamBold, 16, Color3.fromRGB(255, 255, 255), Enum.TextXAlignment.Left
            TitleBtn.Text = ddOptions.Title .. ": " .. states[ddOptions.Title]
            Instance.new("UICorner", TitleBtn).CornerRadius = UDim.new(0, 10)
            Instance.new("UIPadding", TitleBtn).PaddingLeft = UDim.new(0, 10)

            local Arrow = Instance.new("TextLabel", TitleBtn)
            Arrow.Size, Arrow.Position, Arrow.BackgroundTransparency, Arrow.Font, Arrow.TextSize, Arrow.TextColor3, Arrow.Text = UDim2.new(0, 40, 1, 0), UDim2.new(1, -40, 0, 0), 1, GothamBold, 18, Color3.fromRGB(200, 200, 200), "â–¼"

            local ListFrame = Instance.new("ScrollingFrame", ScreenGui)
            ListFrame.BackgroundColor3, ListFrame.BorderSizePixel, ListFrame.Visible, ListFrame.ZIndex, ListFrame.ScrollBarThickness = Color3.fromRGB(40, 40, 40), 0, false, 10, 4
            Instance.new("UICorner", ListFrame).CornerRadius = UDim.new(0, 10)
            local Layout = Instance.new("UIListLayout", ListFrame); Layout.Padding, Layout.HorizontalAlignment = UDim.new(0, 5), Enum.HorizontalAlignment.Center
            Instance.new("UIPadding", ListFrame).PaddingTop = UDim.new(0, 5)

            local open = false
            local tweenInfo = TweenInfo.new(0.25)
            local function toggleDropdown(forceClose)
                open = forceClose and false or not open
                ListFrame.Position = UDim2.fromOffset(Frame.AbsolutePosition.X, Frame.AbsolutePosition.Y + Frame.AbsoluteSize.Y + 5)
                local targetSize = open and UDim2.new(0, Frame.AbsoluteSize.X, 0, math.min(#ddOptions.List * 45, 180)) or UDim2.new(0, Frame.AbsoluteSize.X, 0, 0)
                local targetRotation = open and 180 or 0
                ListFrame.Visible = true
                TweenService:Create(ListFrame, tweenInfo, {Size = targetSize}):Play()
                TweenService:Create(Arrow, tweenInfo, {Rotation = targetRotation}):Play()
                if not open then task.delay(0.25, function() if not open then ListFrame.Visible = false end end) end
            end

            for _, name in ipairs(ddOptions.List) do
                local Btn = Instance.new("TextButton", ListFrame)
                Btn.Size, Btn.BackgroundColor3, Btn.Font, Btn.TextSize, Btn.TextColor3, Btn.Text = UDim2.new(1, -10, 0, 40), Color3.fromRGB(50, 50, 50), Gotham, 16, Color3.fromRGB(255, 255, 255), name
                Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 8)
                Btn.MouseButton1Click:Connect(function()
                    states[ddOptions.Title], TitleBtn.Text = name, ddOptions.Title .. ": " .. name
                    toggleDropdown(true)
                    if ddOptions.Callback then ddOptions.Callback(name) end
                end)
            end
            TitleBtn.MouseButton1Click:Connect(toggleDropdown)
        end

        return Tab
    end
    
    task.wait()
    if #Tabs:GetChildren() > 1 then
        local firstTabName = tabButtons[Tabs:GetChildren()[1].Text] and Tabs:GetChildren()[1].Text
        if firstTabName then
            tabButtons[firstTabName].MouseButton1Click:Fire()
        end
    end

    return Window
end

return Library
